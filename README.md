# LetsChess
![Letschess Logo](./docs/logo-letschess.png)

Welcome to The letschess repository!

Letschess is a platform to play chess online vs other players or vs AI players.

# Build status:
|**Frontend:**|[![Build Test](https://github.com/LuukEbenau/LetsChess-Front/actions/workflows/build-test.yml/badge.svg)](https://github.com/LuukEbenau/LetsChess-Front/actions/workflows/build-test.yml)|[![Quality gate](https://sonarcloud.io/api/project_badges/quality_gate?project=LuukEbenau_LetsChess-Front)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-Front)[![Technical Debt](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-Front&metric=sqale_index)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-Front)[![Bugs](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-Front&metric=bugs)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-Front)[![Duplicated Lines (%)](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-Front&metric=duplicated_lines_density)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-Front)[![Lines of Code](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-Front&metric=ncloc)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-Front)|
|--:|---|---|
|**Backend:**|[![Build_and_test_app](https://github.com/LuukEbenau/LetsChess-Backend/actions/workflows/build%20and%20test.yml/badge.svg)](https://github.com/LuukEbenau/LetsChess-Backend/actions/workflows/build%20and%20test.yml)|[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-Backend&metric=alert_status)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-Backend)[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-Backend&metric=coverage)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-Backend)[![Technical Debt](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-Backend&metric=sqale_index)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-Backend)[![Bugs](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-Backend&metric=bugs)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-Backend)[![Vulnerabilities](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-Backend&metric=vulnerabilities)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-Backend)[![Lines of Code](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-Backend&metric=ncloc)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-Backend)|
|**UserService:**|[![Build_and_test_app](https://github.com/LuukEbenau/LetsChess-UserService/actions/workflows/build%20and%20test.yml/badge.svg)](https://github.com/LuukEbenau/LetsChess-UserService/actions/workflows/build%20and%20test.yml)|[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-UserService&metric=alert_status)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-UserService) [![Coverage](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-UserService&metric=coverage)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-UserService)[![Technical Debt](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-UserService&metric=sqale_index)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-UserService)[![Bugs](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-UserService&metric=bugs)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-UserService)[![Vulnerabilities](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-UserService&metric=vulnerabilities)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-UserService)[![Lines of Code](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-UserService&metric=ncloc)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-UserService)|
|**GameService:**|[![Build_and_test_app](https://github.com/LuukEbenau/LetsChess-GameService/actions/workflows/build%20and%20test.yml/badge.svg)](https://github.com/LuukEbenau/LetsChess-GameService/actions/workflows/build%20and%20test.yml)|[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-GameService&metric=alert_status)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-GameService)[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-GameService&metric=coverage)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-GameService)[![Technical Debt](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-GameService&metric=sqale_index)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-GameService)[![Bugs](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-GameService&metric=bugs)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-GameService)[![Vulnerabilities](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-GameService&metric=vulnerabilities)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-GameService)[![Lines of Code](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-GameService&metric=ncloc)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-GameService)|
|**MatchmakingService:**|[![Build_and_test_app](https://github.com/LuukEbenau/LetsChess-MatchmakingService/actions/workflows/build%20and%20test.yml/badge.svg)](https://github.com/LuukEbenau/LetsChess-MatchmakingService/actions/workflows/build%20and%20test.yml)|[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-MatchmakingService&metric=alert_status)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-MatchmakingService)[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-MatchmakingService&metric=coverage)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-MatchmakingService)[![Technical Debt](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-MatchmakingService&metric=sqale_index)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-MatchmakingService)[![Bugs](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-MatchmakingService&metric=bugs)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-MatchmakingService)[![Vulnerabilities](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-MatchmakingService&metric=vulnerabilities)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-MatchmakingService)[![Lines of Code](https://sonarcloud.io/api/project_badges/measure?project=LuukEbenau_LetsChess-MatchmakingService&metric=ncloc)](https://sonarcloud.io/dashboard?id=LuukEbenau_LetsChess-MatchmakingService)|

For more information about Contineous Integration, Delivery and deployments see: [CI&CD.md](./docs/CI&CD.md)

# Game in action
![Kubernetes Architecture](./docs/game.png)

# Getting started
For starting the project you have 2 options:
- kubernetes
- local running & docker-compose

## kubernetes
- find a place with kubernetes installed to host the application
- ```sudo microk8s enable ingress dns metrics-server storage```
- ```sudo microk8s kubectl apply -f .```
### cookie for rabbitmq services communication
- ```echo -n "some secret key" > cookie```
- ```sudo microk8s kubectl create secret generic erlang-cookie --from-file=./cookie```
- ```rm cookie```
### for admin user
- ```echo -n "letschess" > user```
- ```echo -n "ht4boiuehgjofmcjhyudi" > pass```
- ```sudo microk8s kubectl create secret generic rabbitmq-admin --from-file=./user --from-file=./pass```
- ```rm pass```
- ```rm user```
## install operator
- ```sudo microk8s kubectl apply -f "https://github.com/rabbitmq/cluster-operator/releases/latest/download/cluster-operator.yml"```
- ```sudo microk8s kubectl config set-context --current --namespace=letschess```

### and now pull the repo
- ```git pull <this repository url"```
- ```cd LetsChess/kubernetes```
- optionally edit the hostnames of the ingress to something appropiate 

and then
- ```sudo microk8s kubectl apply -f ./frontend```
- etc. repeat for each folder

and thats it! your application should be up and running.

since the ingress makes use of host mapping, you should configure your OS's hostsfile to redirect the right (sub)domains to your application. 
in my case i've added:
```cs
# Letschess host mapping
192.168.220.29 letschess.nl
192.168.220.29 api.letschess.nl
192.168.220.29 matchmakingservice.letschess.nl
192.168.220.29 userservice.letschess.nl
192.168.220.29 gameservice.letschess.nl
192.168.220.29 aiservice.letschess.nl
192.168.220.29 chatservice.letschess.nl
192.168.220.29 log.letschess.nl
192.168.220.29 dashboard.letschess.nl
```
you probably need to restart your device for these changes to take into effect.

## The application also makes use of KNative, which you can enable as folowwing:
```ps
sudo microk8s enable ambassador
sudo microk8s kubectl apply -f ./knative
```

## local running
for local running you have to have visual studio installed and have a running docker environment.
Then, run the following commands:
```cmd
wsl -d docker-desktop
sysctl -w vm.max_map_count=262144
exit

docker compose up -d

cd LetsChess-Front/app
yarn
yarn start
```
when that's complete you only have to open the .sln file using visual studio and start all the services.

# The application architecture
the (kubernetes) application architecture is as following:
![Kubernetes Architecture](./docs/k8s-diagram.png)

and to go into some more detail of the inner workings of the components of the application, i've designed a C3 diagram of the application:
![C3 Diagram](docs/c3-diagram.png)

# accessing Message queue
to access the message queue, you first need to know the username and password.
you can get these by:
```cmd
username="$(sudo microk8s kubectl get secret letschess-mq-default-user -o jsonpath='{.data.username}' | base64 --decode)"
password="$(sudo microk8s kubectl get secret letschess-mq-default-user -o jsonpath='{.data.password}' | base64 --decode)"
echo $username
echo $password
```
you can then access the mq admin panel at [http://mq.letschess.nl](http://mq.letschess.nl).
